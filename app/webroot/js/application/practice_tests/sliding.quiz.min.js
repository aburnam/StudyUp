$(function(){$.sliding_quiz={version:"1.0"};$.fn.sliding_quiz=function(a){a=$.extend({},{questions:null,callback:function(){}},a);var b=$(this);var c=a.questions.length;var d=[];var e=[];var f=1;if(a.questions===null){b.html("<h2>Cannot find questions.</h2>");return}var g='<div id="quiz-wrapper"><div id="steps"><form id="formElem" name="formElem" action="" method="post">';for(questionIdx=0;questionIdx<c;questionIdx++){if(a.questions[questionIdx]!=undefined){show=questionIdx==0?"show":"";g+='<fieldset class="step '+show+'" question="'+(questionIdx+1)+'" choice=""><legend>'+a.questions[questionIdx].question+"</legend>";for(answerIdx=0;answerIdx<a.questions[questionIdx].answers.length;answerIdx++){g+='<p answer="'+(answerIdx+1)+'">'+a.questions[questionIdx].answers[answerIdx]+"</p>"}d[questionIdx+1]=a.questions[questionIdx].result;g+="</fieldset>"}}g+='</form></div><div id="quiz-notice">Please select an option</div><div id="quiz-navigation" style="display:none;"><ul><li class="disabled"><a href="#" id="back-quiz">Back</a></li><li class="page-number"><a href="#">1/'+c+'</a></li><li class=""><a href="#" id="next-quiz">Next</a><a href="#" id="finish-quiz" style="display: none;">Finish</a></li></ul></div></div></div>';b.html(g);var h=b.find("#steps"),j=b.find("#quiz-notice"),k=b.find(".page-number a"),l=b.find("#next-quiz"),m=b.find("#back-quiz"),n=b.find("#finish-quiz");var o=0;var p=new Array;h.find(".step").each(function(a){var b=$(this);p[a]=o;o+=b.width()});h.width(o);b.find("p").click(function(){var a=$(this);if(a.hasClass("selected")){a.removeClass("selected");a.parents(".step").attr("choice","")}else{a.parents(".step").children("p").removeClass("selected");a.addClass("selected");a.parents(".step").attr("choice",a.attr("answer"))}});b.find("#quiz-navigation").show();l.click(function(a){f=h.find(".show");index=f.index()+1;index++;q.next(index);a.preventDefault()});m.click(function(a){f=h.find(".show");index=f.index()+1;index--;q.back(index);a.preventDefault()});n.click(function(a){q.finish();a.preventDefault()});var q={next:function(a){if(b.find(".show").attr("choice").length===0){j.slideDown(300);return false}j.slideUp();if(p[a-1]!=undefined){h.stop().animate({marginLeft:"-"+p[a-1]+"px"},500,function(){h.find(".show").removeClass("show");f.next("fieldset").addClass("show");k.html(a+"/"+c);m.parent().removeClass("disabled");if(c==a){l.hide();n.show()}})}},back:function(a){j.slideUp();if(a-1>=0){h.stop().animate({marginLeft:"-"+p[a-1]+"px"},500,function(){h.find(".show").removeClass("show");f.prev("fieldset").addClass("show");k.html(a+"/"+c);if(a-1<=0){m.parent().addClass("disabled")}if(c>a){n.hide();l.show();l.parent().removeClass("disabled")}})}},finish:function(){if(b.find(".show").attr("choice").length===0){j.slideDown(300);return false}b.find(".step").each(function(a){questionNumber=$(this).attr("question");userSelect=$(this).attr("choice");e[questionNumber]=userSelect});var f=0,g="",h="";for(i=0;i<d.length;i++){if(a.questions[i]==undefined){continue}bt_rightOrwrong="btn-danger";if(d[i+1]==e[i+1]){f++;bt_rightOrwrong="btn-success"}g+='<a href="javascript:;;" title="Review Question #'+(i+1)+'" questionNumber="'+(i+1)+'" class="quiz-result btn '+bt_rightOrwrong+'">Question #'+(i+1)+"</a>";h+='<div id="q'+(i+1)+'" class="final-result">';h+="<h3>"+a.questions[i].question+"</h3>";for(answersIndex=0;answersIndex<a.questions[i].answers.length;answersIndex++){var k="";if(a.questions[i].result==answersIndex+1){k+="right"}if(e[i+1]==answersIndex+1){k+=" selected";if(a.questions[i].result!=e[i+1]){k+=" wrong"}}h+='<p class="'+k+'">'+a.questions[i].answers[answersIndex]+"</p>"}h+="</div>"}var l=Math.round(f/c*100);var m='<div id="quiz-wrapper"><div id="steps"><form id="formElem" name="formElem" action="" method="post"><h3>You scored '+l+'%. </h3><fieldset class="step"><div class="resultset">'+g+'</div><div id="your-score" class="final-result"><p>Click `Question` button to review your answer</p></div>'+h+"</fieldset></form></div>";b.html(m);b.find("p").unbind("click");b.find(".quiz-result").bind("click",function(){$(".final-result").hide();$(".quiz-result").removeClass("active");$(this).addClass("active");questionNumber=$(this).attr("questionNumber");$("#q"+questionNumber).fadeIn(300)})}}}})